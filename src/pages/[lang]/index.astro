---

import { generateBasicPaths } from '../../utils';
import { getCollection } from 'astro:content';
import BaseLayout from "../../layouts/base-layout.astro";
import { getSlugByPostSlug } from 'utils/common';

export async function getStaticPaths() {
  return ['en', 'pt', 'de'].map(lang => ({ params: { lang } }));
}

const { lang } = Astro.params;

const posts = await getCollection('blog', ({ id }) => {
  return id.startsWith(`${lang}/`); 
});

const sortedPosts = posts.sort((a, b) => {
  const dateA = extractDateFromId(a.id);
  const dateB = extractDateFromId(b.id);
  return dateB.getTime() - dateA.getTime();
});

const POSTS_PER_PAGE = 10;
const paginatedPosts = sortedPosts.slice(0, POSTS_PER_PAGE);

function extractDateFromId(id:string){
  const fileName = id.split('/')[1];
  const match = fileName.match(/^(\d{4})(\d{2})(\d{2})/);
  return match ? new Date(`${match[1]}-${match[2]}-${match[3]}`) : new Date(0);
}

const paths = generateBasicPaths('tags');
---
<BaseLayout lang={lang} title="Code With Beer" description="Latest articles" paths={paths}>
  <ul>
    {paginatedPosts.map( item => 
    <li>
      <div>
        <h2><a href=`${getSlugByPostSlug(item.slug)}`>{item.data.title}</a></h2><br/>
        {item.data["author"]}<br />
        {item.data["publishedAt"]}<br />
        {item.data["description"]}<br />
        tags: [{item.data["tags"]?.join(" â€¢ ")}]<br />
      </div>
    </li>)}
  </ul>
</BaseLayout>
